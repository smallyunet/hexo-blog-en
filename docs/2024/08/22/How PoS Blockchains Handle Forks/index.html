<!-- Stable asset version (for cache busting without full-site churn)--><!DOCTYPE html><html lang="en"><head><title>How PoS Blockchains Handle Forks</title><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><!-- SEO basics--><meta name="description"><!-- Open Graph & Twitter--><link rel="canonical" href="https://en.smallyu.net/2024/08/22/How PoS Blockchains Handle Forks/"><meta property="og:title" content="How PoS Blockchains Handle Forks"><meta property="og:type" content="article"><meta property="og:url" content="https://en.smallyu.net/2024/08/22/How PoS Blockchains Handle Forks/"><meta property="og:site_name" content="smallyu‘s Blog"><meta name="twitter:card" content="summary_large_image"><!-- Browser UI color--><meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f1115"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><!-- stylesheets--><!-- Use a stable, configurable asset version to prevent full-site churn on every build.--><!-- Set `asset_version` in theme _config.yml when you actually change CSS/JS.--><link rel="stylesheet" href="/css/xcode.min.css?v=2025-09-28.27"><link rel="stylesheet" href="/css/post.css?v=2025-09-28.27"><!-- unified typography overrides for both home and post pages--><link rel="stylesheet" href="/css/typography.css?v=2025-09-28.27"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="smallyu‘s Blog" type="application/atom+xml">
</head><body><div><div class="inner"><h1>How PoS Blockchains Handle Forks</h1><div class="time">2024-08-22</div><div class="title-margin"></div><p>Mainstream public blockchains can be classified into three categories based on their consensus mechanisms: PoW, PoS, and PBFT. The choice of consensus mechanism largely determines the network’s TPS, degree of decentralization, and node scale.</p>
<p>Apart from PoW, the other two consensus mechanisms, PoS and PBFT, face a fundamental issue: how to recover when the network experiences a soft fork. Since PoS and PBFT do not require computational power to generate blocks, they cannot use the same longest chain rule as PoW.</p>
<h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><h4 id="Consensus-Overview"><a href="#Consensus-Overview" class="headerlink" title="Consensus Overview"></a>Consensus Overview</h4><p>PoW-based chains include BTC, BCH, BSV, LTC, DOGE, ZEC, and others. PoW uses the longest chain rule, where nodes facing multiple forked chains simply choose the one with the highest block height. Since generating each block requires significant computational power, the cost of attacking the network is high.</p>
<p>PoS-based chains include ETH, BNB, TRON, DOT, TON, ADA, AVAX, NEO, and others. Almost all current smart contract platform chains use PoS consensus.</p>
<p>PBFT-based chains include ATOM, SOL, TON, ONT, APT, SUI, etc. Among them, Cosmos is the most well-known, Solana shows potential to surpass Ethereum, and The Open Network has also developed well this year.</p>
<p>You might find it strange to classify SOL under PBFT. Isn’t SOL based on PoH consensus? Doesn’t SOL have staking features, such as earning rewards through staking in the Solflare wallet? TON also has staking and rewards, right?</p>
<p>These are two separate issues.</p>
<p>Firstly, Solana indeed developed and uses a BFT-like consensus called <a href="https://solana.com/news/8-innovations-that-make-solana-the-first-web-scale-blockchain">Tower BFT</a>. PoH is used to solve the clock problem on the Solana chain, not as a complete consensus mechanism.</p>
<p>Secondly, when it comes to PoS+BFT consensus, should it be classified as PoS or BFT? The above classification mainly refers to PoS, dPoS, PoS Casper, etc., while anything involving BFT is classified under PBFT for distinction. For instance, Cosmos also has staking and reward features, but few people would say Cosmos uses PoS.</p>
<h4 id="About-Forks"><a href="#About-Forks" class="headerlink" title="About Forks"></a>About Forks</h4><p>When dealing with forks in PoS and PBFT consensus, there are two aspects to consider.</p>
<p>One aspect is whether the staker list (called <code>Validators</code> in Ethereum, <code>Stakeholders</code> in Cardano) is consistent. Since PoS and PBFT generally use VRF to select a node from a candidate list as the block producer, what are the similarities and differences in handling this issue?</p>
<p>The other aspect is the rule for choosing the chain when the network forks (called <code>Forkchoice</code> in Ethereum, <code>Chain selection rule</code> in Cardano).</p>
<h3 id="Inconsistent-Staker-List"><a href="#Inconsistent-Staker-List" class="headerlink" title="Inconsistent Staker List"></a>Inconsistent Staker List</h3><h4 id="Consortium-Chains"><a href="#Consortium-Chains" class="headerlink" title="Consortium Chains"></a>Consortium Chains</h4><p>Let’s start with the simplest, consortium chains. Consortium chains do not have coins, so there is no staking involved, only pure PBFT.</p>
<p>As the name suggests, consortium chains have very high entry barriers. You need to be reviewed or authorized to become a consortium member. Technically, this means that to join the network, it must be done with the knowledge of other nodes. For example, all nodes’ configuration files contain a list of network members, defining the public keys and corresponding indexes of the network nodes. To add a node, all other nodes need to update their configuration files.</p>
<p>When a node produces a block, it randomly selects one from this list using VRF as the block producer. Generally, VRF returns a simple number corresponding to the index in the public key list, and the block producer signs the block with this public key.</p>
<p>This method is somewhat cumbersome but is characteristic of consortium chains. In this mode, the staker list is unlikely to be inconsistent. If it is, it means a configuration file error. A configuration error will always be wrong, making it easy to troubleshoot.</p>
<h4 id="Cosmos"><a href="#Cosmos" class="headerlink" title="Cosmos"></a>Cosmos</h4><p>Cosmos Hub uses a consensus called <a href="https://docs.cometbft.com/v0.37/introduction/">CometBFT</a>. The basic process involves spending no less than 180 ATOM to register as a Validator, after which you may be selected as a block producer.</p>
<p>Since BFT consensus requires voting before block production, if there is indeed an inconsistency in the staker list within the network, two blocks might be produced at the same block height by different nodes, and other nodes in the network would vote on these blocks.</p>
<p>There are two scenarios here: a normal network and an abnormal network.</p>
<p>In a normal network, when two blocks are produced, only one of them can receive more than 2&#x2F;3 of the votes; it’s impossible for both blocks to receive more than 2&#x2F;3 of the votes. So, before block production, nodes with inconsistent staker lists are already excluded from the process, ensuring that they don’t affect subsequent procedures.</p>
<p>In an abnormal network, where a node cannot perceive the presence of other nodes, even if its staker list matches a few nodes in the current sub-network, the other nodes will not cast their votes. Unless the entire sub-network is isolated and the staker list coincidentally shares the same error, that sub-network would be isolated, playing alone on a local network. Network anomalies themselves are abnormal situations, isolated from the outside world.</p>
<h4 id="Cardano"><a href="#Cardano" class="headerlink" title="Cardano"></a>Cardano</h4><p>Cardano’s PoS is the purest form of PoS, without a voting mechanism. Cardano’s consensus has undergone <a href="https://iohk.io/en/blog/posts/2022/06/03/from-classic-to-chronos-the-implementations-of-ouroboros-explained/">multiple evolutions</a> (there’s a lot to it, and I haven’t finished reading it).</p>
<p>The rule in the Cardano network is that anyone can stake any amount into Stake pools to become a <a href="https://docs.cardano.org/about-cardano/learn/delegation/">Delegator</a>. These Delegators share the pool’s rewards in proportion to their staked amount but do not have the right to produce blocks.</p>
<p>In the Cardano network, the entities with the right to produce blocks are Stake pools. In other words, nodes that may be selected as block producers are already on the <a href="https://preprod.cexplorer.io/pool">pool list</a>. There aren’t many of them, around 300 at present, and each slot randomly selects one to produce a block.</p>
<p>So what happens if there is an inconsistency in the Stake pools list among nodes after registration? Cardano’s documentation <a href="https://developers.cardano.org/docs/operate-a-stake-pool/introduction-to-cardano#how-it-works">describes</a> that when two blocks are produced in the same slot, the Chain Selection Rule is activated. This means that when a second block is produced, the chain has already forked, and all nodes will activate the chain selection rule to recover.</p>
<h4 id="Ethereum"><a href="#Ethereum" class="headerlink" title="Ethereum"></a>Ethereum</h4><p>To become a Validator in Ethereum, you need to spend 32 ETH to register your node information on the <a href="https://etherscan.io/address/0x00000000219ab540356cbb839cbe05303d7705fa">staking contract</a>, after which all Validators retrieve the staker list from the contract.</p>
<p>How do you ensure that other Validators have synchronized the staker information from the contract to their local node? You can find a field called <a href="https://github.com/ethereum/consensus-specs/blob/v1.3.0/specs/phase0/validator.md#eth1-data">Eth Data</a> in any block on the Beacon Chain explorer, such as <a href="https://beaconcha.in/block/20584195">this block</a>. This field is crucial for the staker list. When a validator is selected as the block producer, it packages the current staker list synchronized by the node, including the total number of stakers and the Deposit root information, into the block.</p>
<p>The Ethereum network updates the staker list approximately every 17 hours. During this period, new validators are only added to the network if the Eth Data field in more than half of the blocks contains the new validator. </p>
<p>Thus, the process of adding Validators to Ethereum is long and strict. The staker list is difficult to be inconsistent under such rules.</p>
<h3 id="Chain-Selection-After-Forks"><a href="#Chain-Selection-After-Forks" class="headerlink" title="Chain Selection After Forks"></a>Chain Selection After Forks</h3><h4 id="Ethereum-1"><a href="#Ethereum-1" class="headerlink" title="Ethereum"></a>Ethereum</h4><p>If multiple forks occur in Ethereum, the choice is relatively easy because Ethereum has a voting mechanism. Each block contains the number of validators that voted for it. When a fork occurs, simply selecting the block with the most votes should suffice.</p>
<p>In fact, Ethereum’s fork choice is based on a <a href="https://ethos.dev/beacon-chain">checkpoint mechanism</a>. Each block is a slot, every 32 slots form an epoch, and each epoch is a checkpoint. A checkpoint that receives more than 2&#x2F;3 of the votes becomes justified. When the checkpoint after the next one also becomes justified, the current checkpoint is considered finalized. Therefore, in Ethereum, a transaction takes 15 minutes to be marked as finalized.</p>
<p>The checkpoints mentioned here are the basis for <a href="https://arxiv.org/abs/1710.09437">FFG</a> fork choice. Each chain will choose the one with more checkpoints, so Ethereum’s consensus does not select the chain with the most blocks, but the one with the most checkpoints. The chain with the most checkpoints is the main chain.</p>
<h4 id="Cardano-1"><a href="#Cardano-1" class="headerlink" title="Cardano"></a>Cardano</h4><p>Cardano currently uses a <a href="https://developers.cardano.org/docs/operate-a-stake-pool/introduction-to-cardano/#what-if-for-some-reason-there-is-a-fork">Chain selection rule</a> provided by the <a href="https://dl.acm.org/doi/10.1145/3243734.3243848">Ouroboros Genesis</a> version.</p>
<p>The previous version of Ouroboros Genesis was <a href="https://link.springer.com/chapter/10.1007/978-3-319-78375-8_3">Ouroboros Praos</a>. The Praos version introduced a rule called <code>maxvalid</code>, and the Genesis version made some improvements to this rule by incorporating the <code>moving checkpoint</code> feature, resulting in a new rule called <code>maxvalid-mc</code>.</p>
<p>The moving checkpoint is a simple concept: when facing multiple forked chains, if the fork does not exceed <code>k</code> blocks, the chain with the longest length is selected. If the fork exceeds <code>k</code> blocks, it is ignored entirely. This means the local chain will only select the longest chain within the <code>k</code> blocks range. The range of <code>k</code> blocks is referred to as the moving checkpoint. The advantage of this restriction is that it helps avoid the longest chain attack. Of course, Cardano established this rule through a series of academic analyses and practical tests.</p>
<h4 id="Cosmos-1"><a href="#Cosmos-1" class="headerlink" title="Cosmos"></a>Cosmos</h4><p>In PBFT chains like Cosmos, as long as the staker list is consistent under normal network conditions, forks will not occur.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>In summary, each consensus mechanism has detailed rules for handling forks, and these rules have been tested in real-world scenarios by established public blockchains. The specific implementation of fork recovery is closely tied to the design philosophy of each blockchain.</p>
</div></div></body><!-- Defer non-critical scripts for better performance--><script defer src="/js/jquery.min.js?v=2025-09-28.27"></script><script defer src="/js/highlight.min.js?v=2025-09-28.27"></script><script defer src="/js/main.js?v=2025-09-28.27"></script><script defer src="/js/lightbox.js?v=2025-09-28.27"></script><script defer src="/js/bootstrap.min.js?v=2025-09-28.27"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5JRBZ6P1W3"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-5JRBZ6P1W3');</script></html>